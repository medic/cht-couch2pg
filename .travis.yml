language: node_js
# TODO: work out which node we run on, only support one?
node_js:
   - "0.12"
   - "0.10"
   - "5"

env:
  global:
    # - INT_PG_USER="postgres"
    - INT_COUCHDB_URL="http://localhost:5984/medic-analytics-test"
    # TODO we shouldn't need this
    - POSTGRESQL_URL="postgres://postgres@localhost:5432/medicdata"
    # TODO we shouldn't need this
    - COUCHDB_URL="http://localhost:5984/medic"

sudo: required

services:
   - couchdb

# TODO uncomment this once Travis updates 9.4.0 to latest patch level
# addons:
#    postgresql: "9.4"

before_script:
   # TODO remove this once Travis updates 9.4.0 to latest patch level
   - sudo apt-get update
   - sudo apt-get purge postgresql-9.1 postgresql-9.2 postgresql-9.3
   - sudo apt-get install postgresql-client-common postgresql-9.4
   - sudo service postgresql start
   - psql -c 'create database travis' -U postgres
   # TODO experiment with removing this, we shouldn't need it
   - psql -c "CREATE ROLE full_access;" -U postgres
   # TODO we shouldn't need this
   - psql -c "CREATE DATABASE medicdata WITH OWNER postgres;" -U postgres

script:
   # Used by (so far non-existent) spec tests for xmlforms
   - ./bin/replace_couch.sh
   - grunt ci

# notifications:
#   webhooks:
#     urls:
#       - https://medic.slack.com/services/hooks/travis?token=xcYT8yusfEdSwLskhBxK4Vwj
#     on_success: change
#     on_failure: always
#   email:
#     recipients:
#       - dev@medicmobile.org
